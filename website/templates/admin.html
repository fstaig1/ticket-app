{% extends 'base.html' %}

{% block content %}
  <div class="container text-center">
    <h1 class="m-2">Admin Dashboard</h1>
    {% with messages = get_flashed_messages() %}
      {% if messages %}
        <div class="border mb-2"></div>
        <div class="text-bg-danger rounded">{{ messages[0] }}</div>
      {% endif %}
    {% endwith %}
    <div class="border mt-2 mb-2"></div>
    <div class="row">
      <div class="col-4 border-end text-center">
        <div class="row">
          <form method="POST" action="/admin/view_all_users" class="col">
            <div>
              <button class="btn btn-primary">View All Users</button>
            </div>
          </form>

          <form method="POST" action="/admin/view_all_venues" class="col">
            <div>
              <button class="btn btn-primary">View All Venues</button>
            </div>
          </form>
        </div>
        <div class="row mt-2">
          <form method="POST" action="/admin/view_all_artists" class="col">
            <div>
              <button class="btn btn-primary">View All Artists</button>
            </div>
          </form>

          <form method="POST" action="/admin/view_all_concerts" class="col">
            <div>
              <button class="btn btn-primary">View All Concerts</button>
            </div>
          </form>
        </div>
        <div class="border mt-2 mb-2"></div>
        <h3>Create New User</h3>
        <form method="POST" action="/admin/create_user">
          {{ createUserForm.csrf_token() }}
          <div>
            {{ createUserForm.firstname(placeholder = 'First Name', class = 'form-control', required = 'required', type = 'text') }}
            {% for error in createUserForm.firstname.errors %}
              {{ error }}
            {% endfor %}
          </div>
          <div class="mt-2">
            {{ createUserForm.lastname(placeholder = 'Last Name', class = 'form-control', required = 'required', type = 'text') }}
            {% for error in createUserForm.lastname.errors %}
              {{ error }}
            {% endfor %}
          </div>
          <div class="mt-2">
            {{ createUserForm.email(placeholder = 'Email', class = 'form-control', required = 'required', type = 'email') }}
            {% for error in createUserForm.email.errors %}
              {{ error }}
            {% endfor %}
          </div>
          <div class="mt-2">
            {{ createUserForm.password(placeholder = 'Password', class = 'form-control', required = 'required', type = 'password') }}
            {% for error in createUserForm.password.errors %}
              {{ error }}
            {% endfor %}
          </div>
          <div class="mt-2">
            {{ createUserForm.confirm_password(placeholder = 'Confirm Password', class = 'form-control', required = 'required', type = 'password') }}
            {% for error in createUserForm.confirm_password.errors %}
              {{ error }}
            {% endfor %}
          </div>
          <div class="mt-2">
            <select class="form-select" id="role" name="role" required="" selected="user">
              <option value="user">User</option>
              <option value="admin">Admin</option>
              <option value="venue">Venue</option>
            </select>
          </div>
          <div class="mt-2">
            {{ createUserForm.venueId(placeholder = 'Venue ID (only enter if role is venue)', class = 'form-control', type = 'number') }}
            {% for error in createUserForm.venueId.errors %}
              {{ error }}
            {% endfor %}
          </div>
          <div class="mt-2">{{ createUserForm.submit(type = 'submit', class = 'btn btn-primary center') }}</div>
        </form>

        <div class="border mt-2 mb-2"></div>

        <h3>Create New Venue</h3>
        <form method="POST" action="/admin/create_venue">
          {{ createVenueForm.csrf_token() }}
          <div>
            {{ createVenueForm.name(placeholder = 'Name', class = 'form-control', required = 'required', type = 'text') }}
            {% for error in createVenueForm.name.errors %}
              {{ error }}
            {% endfor %}
          </div>
          <div class="mt-2">
            {{ createVenueForm.location(placeholder = 'Location', class = 'form-control', required = 'required', type = 'text') }}
            {% for error in createVenueForm.location.errors %}
              {{ error }}
            {% endfor %}
          </div>
          <div class="mt-2">
            {{ createVenueForm.capacity(placeholder = 'Capacity', class = 'form-control', required = 'required', type = 'nunber') }}
            {% for error in createVenueForm.capacity.errors %}
              {{ error }}
            {% endfor %}
          </div>
          <div class="mt-2">{{ createVenueForm.submit(type = 'submit', class = 'btn btn-primary center') }}</div>
        </form>
      </div> <!-- end of column -->

      <div class="col">
        <div>
          <div>
            {% if current_users %}
              <h2>All Users</h2>
              <div>
                <table class="table table-striped center table-hover">
                  <tr class="fw-medium text-start table-active">
                    <th class="border">ID</th>
                    <th class="border">Name</th>
                    <th class="border">Email</th>
                    <th class="border">Role</th>
                    <th class="border">Registered</th>
                    <th class="border">Last Logged In</th>
                    <th class="border">Delete User</th>
                  </tr>
                  {% for user in current_users %}
                    <tr class="text-start">
                      <td class="border fw-medium">{{ user.id }}</td>
                      <td class="border">{{ user.firstname + ' ' + user.lastname }}</td>
                      <td class="border">{{ user.email }}</td>
                      <td class="border">{{ user.role }}</td>
                      <td class="border">{{ user.registered_on.strftime('%d/%m/%Y %H:%M:%S') }}</td>
                      {% if user.current_logged_in %}
                        <td class="border">{{ user.current_logged_in.strftime('%d/%m/%Y %H:%M:%S') }}</td>
                      {% else %}
                        <td class="border">Not yet logged in</td>
                      {% endif %}
                      <td class="border text-center">
                        <form method="POST" action="/admin/delete_user">
                          <button name="delete_user_button" class="btn btn-danger" value="{{ user.id }}" {% if user == current_user %}disabled{% endif %}>X</button>
                        </form>
                      </td>
                    </tr>
                  {% endfor %}
                </table>
              </div>
            {% endif %}
          </div>
        </div>

        <div>
          <div>
            {% if venues %}
              <h2>All Venues</h2>
              <div>
                <table class="table table-striped center table-hover">
                  <tr class="fw-medium text-start table-active">
                    <th class="border">ID</th>
                    <th class="border">Name</th>
                    <th class="border">Location</th>
                    <th class="border">Capacity</th>
                    <th class="border">Delete Venue</th>
                  </tr>
                  {% for venue in venues %}
                    <tr class="text-start">
                      <td class="border fw-medium">{{ venue.id }}</td>
                      <td class="border">{{ venue.name }}</td>
                      <td class="border">{{ venue.location }}</td>
                      <td class="border">{{ venue.capacity }}</td>
                      <td class="border text-center">
                        <form method="POST" action="/admin/delete_venue">
                          <button name="delete_venue_button" class="btn btn-danger" value="{{ venue.id }}">X</button>
                        </form>
                      </td>
                    </tr>
                  {% endfor %}
                </table>
              </div>
            {% endif %}
          </div>
        </div>

        <div>
          <div>
            {% if artists %}
              <h2>All Artists</h2>
              <div>
                <table class="table table-striped center table-hover">
                  <tr class="fw-medium text-start table-active">
                    <th class="border">ID</th>
                    <th class="border">Name</th>
                    <th class="border">Delete Artist</th>
                  </tr>
                  {% for artist in artists %}
                    <tr class="text-start">
                      <td class="border fw-medium">{{ artist.id }}</td>
                      <td class="border">{{ artist.name }}</td>
                      <td class="border text-center">
                        <form method="POST" action="/admin/delete_artist">
                          <button name="delete_artist_button" class="btn btn-danger" value="{{ artist.id }}">X</button>
                        </form>
                      </td>
                    </tr>
                  {% endfor %}
                </table>
              </div>
            {% endif %}
          </div>
        </div>

        <div>
          <div>
            {% if concerts %}
              <h2>All Concerts</h2>
              <div>
                <table class="table table-striped center table-hover">
                  <tr class="fw-medium text-start table-active">
                    <th class="border">Concert ID</th>
                    <th class="border">Artist ID</th>
                    <th class="border">Artist Name</th>
                    <th class="border">Venue ID</th>
                    <th class="border">Venue Name</th>
                    <th class="border">Ticket Price</th>
                    <th class="border">Delete Concert</th>
                  </tr>
                  {% for concert in concerts %}
                    <tr class="text-start">
                      <td class="border fw-medium">{{ concert.id }}</td>
                      <td class="border">{{ concert.artistId }}</td>
                      <td class="border">{{ concert.artistName }}</td>
                      <td class="border">{{ concert.venueId }}</td>
                      <td class="border">{{ concert.venueName }}</td>
                      <td class="border">£{{ concert.ticketPrice }}</td>
                      <td class="border text-center">
                        <form method="POST" action="/admin/delete_concert">
                          <button name="delete_concert_button" class="btn btn-danger" value="{{ concert.id }}">X</button>
                        </form>
                      </td>
                    </tr>
                  {% endfor %}
                </table>
              </div>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
  </div>
{% endblock %}
